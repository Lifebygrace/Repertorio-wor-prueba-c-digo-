<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Subir Canci√≥n</title>
</head>
<body>
  <h2>Subir nueva canci√≥n</h2>
  <form id="songForm">
    <label>Nombre de la canci√≥n:</label><br>
    <input type="text" id="songName" required><br><br>

    <label>Im√°genes de acordes (m√°ximo 2):</label><br>
    <input type="file" id="imageFiles" accept="image/*" multiple><br><br>

    <label>Archivo de audio:</label><br>
    <input type="file" id="audioFile" accept="audio/*"><br><br>

    <button type="submit">Subir canci√≥n</button>
  </form>

  <p id="status" style="color: green;"></p>
  <p id="error-msg" style="color: red;"></p>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"></script>

  <script>
    // ‚úÖ Reemplaza esto con tu propia configuraci√≥n de Firebase
    const firebaseConfig = {
      apiKey: "TU_API_KEY",
      authDomain: "TU_AUTH_DOMAIN",
      projectId: "TU_PROJECT_ID",
      storageBucket: "TU_STORAGE_BUCKET",
      messagingSenderId: "TU_SENDER_ID",
      appId: "TU_APP_ID"
    };

    // üîß Inicializar Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const storage = firebase.storage();

    const form = document.getElementById('songForm');
    const status = document.getElementById('status');
    const errorMsg = document.getElementById('error-msg');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      status.textContent = '';
      errorMsg.textContent = '';

      const name = document.getElementById('songName').value;
      const imageFiles = document.getElementById('imageFiles').files;
      const audioFile = document.getElementById('audioFile').files[0];

      if (!name) {
        errorMsg.textContent = "Debes ingresar el nombre de la canci√≥n.";
        return;
      }

      if (imageFiles.length > 2) {
        errorMsg.textContent = "Solo puedes subir hasta 2 im√°genes.";
        return;
      }

      try {
        const imageUrls = [];
        for (let i = 0; i < imageFiles.length; i++) {
          const file = imageFiles[i];
          const ref = storage.ref().child(`songs/${name}/image${i + 1}_${file.name}`);
          await ref.put(file);
          const url = await ref.getDownloadURL();
          imageUrls.push(url);
        }

        let audioUrl = '';
        if (audioFile) {
          const audioRef = storage.ref().child(`songs/${name}/audio_${audioFile.name}`);
          await audioRef.put(audioFile);
          audioUrl = await audioRef.getDownloadURL();
        }

        await db.collection('songs').add({
          name: name,
          images: imageUrls,
          audio: audioUrl,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });

        status.textContent = "‚úÖ Canci√≥n guardada correctamente.";
        form.reset();
      } catch (error) {
        console.error(error);
        errorMsg.textContent = "‚ùå Error: " + error.message;
      }
    });
  </script>
</body>
</html>